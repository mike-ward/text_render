---
phase: 21-multi-display-polish
plan: 03
type: execute
wave: 2
depends_on: [21-01, 21-02]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Japanese IME completes basic flow: romaji -> hiragana -> kanji -> commit"
    - "Chinese IME completes basic flow: pinyin -> candidates -> select -> commit"
    - "Korean IME completes basic flow: jamo -> syllable -> commit"
    - "Candidate window appears on correct monitor"
    - "No 2x offset on Retina displays"
  artifacts: []
  key_links: []
---

<objective>
End-to-end verification of CJK IME on multi-display and Retina

Purpose: Confirm all three CJK IMEs complete basic flow after multi-display fixes.
This is the final milestone verification for v1.4 CJK IME.

Output: Verified working CJK IME or documented remaining issues
</objective>

<execution_context>
@/Users/mike/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mike/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-multi-display-polish/21-RESEARCH.md
@.planning/phases/21-multi-display-polish/21-01-SUMMARY.md
@.planning/phases/21-multi-display-polish/21-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build and launch editor_demo</name>
  <files></files>
  <action>
Build and launch the editor demo for manual testing:

```bash
cd /Users/mike/Documents/github/vglyph
v examples/editor_demo.v
./examples/editor_demo
```

If build fails, check for compile errors from Plan 01/02 changes.
  </action>
  <verify>
editor_demo window appears and is responsive
  </verify>
  <done>
editor_demo running and ready for IME testing
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Multi-display coordinate fixes and Korean IME improvements from Plans 01-02</what-built>
  <how-to-verify>
## CJK IME End-to-End Verification

### Setup
1. editor_demo is running
2. Have access to Japanese, Chinese, and Korean IME (System Preferences > Keyboard > Input Sources)

### Test 1: Japanese IME Basic Flow
1. Switch to Japanese Hiragana IME (Cmd+Space or menu bar)
2. Click in editor text area
3. Type "nihongo" on keyboard
4. Expected: See "にほんご" as preedit (underlined)
5. Press Space to convert
6. Expected: See kanji candidates (日本語)
7. Press Enter to commit
8. Expected: Text "日本語" committed, no underline

### Test 2: Chinese IME Basic Flow
1. Switch to Chinese Pinyin IME
2. Click in editor text area
3. Type "zhongwen"
4. Expected: See pinyin preedit with candidates
5. Press Space or number key to select
6. Expected: Text "中文" committed

### Test 3: Korean IME Basic Flow
1. Switch to Korean 2-Set IME
2. Click in editor text area
3. Type 'g' key (ㄱ)
4. Expected: See "ㄱ" immediately (FIRST keypress, not second)
5. Type 'k' key (ㅏ)
6. Expected: See "가" (combined syllable)
7. Press Space to commit
8. Expected: Text "가" committed

### Test 4: Multi-Monitor (if external display available)
1. Drag editor_demo window to external monitor
2. Switch to Japanese IME
3. Type "test"
4. Expected: Candidate window appears on EXTERNAL monitor (not jumping to primary)

### Test 5: Retina Display (if on Retina Mac)
1. With editor_demo on Retina display
2. Switch to Chinese IME
3. Type "ni"
4. Expected: Candidate window appears near cursor (not 2x offset)

### Results
Document pass/fail for each test. If Korean first-keypress still fails, note whether it's
improved (works more often) or unchanged.
  </how-to-verify>
  <resume-signal>
Report results for each test:
- Test 1 (Japanese): PASS/FAIL
- Test 2 (Chinese): PASS/FAIL
- Test 3 (Korean first-keypress): PASS/FAIL/IMPROVED
- Test 4 (Multi-monitor): PASS/FAIL/SKIPPED (no external display)
- Test 5 (Retina): PASS/FAIL/SKIPPED (not Retina)

Type "all pass" if everything works, or describe failures.
  </resume-signal>
</task>

<task type="auto">
  <name>Task 3: Update STATE.md and document results</name>
  <files>.planning/STATE.md</files>
  <action>
Based on checkpoint results, update STATE.md:

If all tests pass:
- Update "Current Position" to show Phase 21 complete
- Remove Korean IME from "Known Issues" if fixed
- Add to Decisions if any new patterns established

If Korean first-keypress still fails:
- Keep in "Known Issues" with updated status
- Document which workarounds were attempted
- Note whether issue is IMPROVED or UNCHANGED

If multi-monitor or Retina tests fail:
- Add to "Known Issues" with specific failure details
- Note which monitor configurations were tested
  </action>
  <verify>
STATE.md reflects actual test results
  </verify>
  <done>
Project state accurately reflects Phase 21 completion status
  </done>
</task>

</tasks>

<verification>
Phase 21 complete when:
1. All automated fixes from Plans 01-02 are in place
2. Human verification confirms CJK IME works (or documents remaining issues)
3. STATE.md updated with accurate status
</verification>

<success_criteria>
- Japanese IME: romaji -> hiragana -> kanji -> commit works
- Chinese IME: pinyin -> candidates -> select -> commit works
- Korean IME: jamo -> syllable -> commit works (first-keypress fix attempted)
- Multi-monitor: Candidate window on correct monitor (if tested)
- Retina: No 2x coordinate offset (if tested)
- STATE.md reflects results
</success_criteria>

<output>
After completion, create `.planning/phases/21-multi-display-polish/21-03-SUMMARY.md`

This is the FINAL summary for v1.4 CJK IME milestone. Document:
- Overall milestone status (COMPLETE or PARTIAL)
- Which CJK IMEs work fully
- Any remaining known issues
- Recommendations for future work (if any)
</output>
